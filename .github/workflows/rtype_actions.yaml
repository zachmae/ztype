## NAME OF THE WORKFLOW
name: Rtype Actions

## CONDITIONS FOR THE WORKFLOW TO RUN:
on:
  push:
    branches-ignore:
      - 'ga-ignore*'
  pull_request:
    branches-ignore:
      - 'ga-ignore*'

  workflow_dispatch:

## DEFAULTS FOR THE WORKFLOW:
defaults:
  run:
    shell: bash


jobs:
  linux_testing_setup:
    runs-on: ubuntu-latest
    container: epitechcontent/epitest-docker
    timeout-minutes: 5
    steps:
      ## GET THE REPOSITORY
      - name: checkout
        uses: actions/checkout@v3

      ## SETUP THE REPOSITORY
      - name: informations
        run: |
          echo Welcome to Zachmae workflow \
          echo Repository:\n\t'$GITHUB_REPOSITORY' \
          echo Branch:\n\t${GITHUB_REF##*/} \
          echo Size: \
          du -skh --exclude=.git --exclude=.github --exclude=.gitignore \
      - name: clean_repository
        run: rm -rf build/*

      ## BUILD THE PROJECT
      - name: build_repo
        run: ./compile_linux

  ## MIRRORRING THE REPOSITORY
  mirrorring:
    runs-on: ubuntu-latest
    timeout-minutes: 2
    needs: [ linux_testing_setup ]
    if: |
      always() &&
      !contains(needs.*.result, ${{ 'failure' }} ) &&
      ${GITHUB_REF##*/} == 'master'